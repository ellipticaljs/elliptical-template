!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils"),require("elliptical-class"),require("dustjs"),require("elliptical-dust-helpers")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-class","dustjs","elliptical-dust-helpers"],e):(t.elliptical.$Template=e(t.elliptical.utils,t.elliptical.Class,t.dust,t.dust.helpers),t.returnExports=t.elliptical.$Template)}(this,function(t,e,r,o){function i(t,e){for(var r=a(t._root),o=e.split("."),i=0;i<o.length;i++)r+="/"+o[i];return r+=".html"}function n(t,e,r){var o=i(t,e);$.get(o,function(o){if(o){var i=t.compile(o,e);t.loadSource(i),r(null,o)}else r(new Error("Error: cannot find "+e+" in views folder"),null)})}function s(t,e,r,o,i){var n=a(t.root),s=n+"/"+e+"/"+r+".html",c=e+"."+r,l=t.$provider;$.get(s,function(t){if(t){var e=l.compile(t,c);l.loadSource(e),l.render(c,o,i)}else i("Error: Controller View does not exist",null)})}function c(t,e,r,o){var i=t.$provider,n=i.cache;p.isEmpty(n)?l(t.model,t.$store,i,t.api,function(){i.render(e,r,o)}):i.render(e,r,o)}function l(t,e,o,i,n){if(e)e.getAll(t,function(t,e){for(var o=0,i=e.length;i>o;o++){var s=JSON.parse(e[o]);r.loadSource(s)}n&&n()});else var s=d,c=0,l=setInterval(function(){var t=o.cache;p.isEmpty(t)?(c++,c>s&&n&&n()):(clearInterval(l),n&&n())},u)}function a(t){return"/"===h.lastChar(t)?h.trimLastChar(t):t}var u=250,d=5,f="/app/views",p=t.object,h=t.string,b=t.network;r.optimizers.format=function(t,e){return e},r._root=f,r.onLoad=function(t,e){if(t.indexOf(".")>-1)n(r,t,e);else{var o=new Error("Partial Not Found: "+t);e(o,null)}};var v;return v=e.extend({_data:{},_$store:null,get $store(){return this._$store},set $store(t){this._$store=t},_base:{server:"base",client:"base-client"},get base(){return this._base},set base(t){this._base=t},_$provider:r,get $provider(){return this._$provider},set $provider(t){this._$provider=t,this._$provider._root=this._root},compile:r.compile,cache:r.cache,_model:"template",get model(){return this._model},set model(t){this._model=t},_api:"/api/template",get api(){return this._api},set api(t){this._api=t},_root:f,get root(){return this._root},set root(t){this._root=t,this._$provider._root=t},getBase:function(){return b.isBrowser()?this.base.client:this.base.server},setRoot:function(t){this.root=t,this._root=t,this._$provider._root=t},render:function(t,e,r){var o=this.$provider,i=o.cache,l=!1;if(l=i?p.isEmpty(i):!0,!l&&void 0!==i[t])return void o.render(t,e,r);if("object"==typeof t){var a=t.name.toLowerCase(),u=t.view.toLowerCase(),d=a+"."+u;l?s(this,a,u,e,r):i[d]?o.render(d,e,r):s(this,a,u,e,r)}else t.indexOf(".")>-1?n(o,t,function(){o.render(t,e,r)}):c(this,t,e,r)},setBrowserGlobal:function(){"undefined"!=typeof window&&(window.dust=this.$provider)}},{init:function(t){t&&(this.constructor._data.base=!0),this.root=this.constructor.root},render:function(t,e,r){if(this.constructor._data.base){var o={render:this.constructor.getBase()},i=this.constructor.$provider.makeBase(o);e=i.push(e)}this.constructor.render(t,e,r)}})});